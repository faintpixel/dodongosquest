/*
* Software: iio Engine
* Version: 1.2.1
* Author: Sebastian Bierman-Lytle
* Released: 3/16/2013
* Website: iioEngine.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:

* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.

* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.

* 3. This notice may not be removed or altered from any source distribution.
*/
(function(){if(!Array.prototype.forEach){Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n){e.call(t,this[n],n,this)}}}if(!Array.prototype.insert){Array.prototype.insert=function(e,t){this.splice(e,0,t)}}if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var iio={};(function(e){function t(){}e.inherit=function(e,n){var r=e;t.prototype=n.prototype;e.prototype=new t;e.prototype.constructor=r};e.start=function(t,n,r,i){if(typeof t=="undefined")throw new Error("ioStart: No application script provided | Docs: ioController -> ioStart");if(typeof e.apps=="undefined")e.apps=[];e.apps[e.apps.length]=new e.ioAppManager(t,n,r,i);return e.apps[e.apps.length-1]};e.stop=function(t){if(e.isNumber(t))e.apps.splice(t,1);else for(var n=0;n<e.apps.length;n++)if(e.apps[n]==t)e.apps.splice(n,1)};e.requestTimeout=function(e,t,n){var r=(new Date).getTime();var i=Math.max(0,1e3/e-(r-t));var s=setTimeout(function(){n(r+i)},i);t=r+i;return s};e.isNumber=function(e){return!isNaN(e-0)&&e!==null&&e!==""&&e!==false};e.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return true}else if(e.attachEvent){e.attachEvent("on"+t,n);return true}else return false};e.getRandomNum=function(e,t){e=e||0;t=t||1;return Math.random()*(t-e)+e};e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e};e.getioVecsFromPointList=function(t){var n=[];for(var r=0;r<t.length;r++){if(typeof t[r].x!="undefined")n[n.length]=new e.ioVec(t[r]);else{n[n.length]=new e.ioVec(t[r],t[r+1]);r++}}return n};e.getCentroid=function(t){var n;var r;for(var i=0;i<t.length;i++){n+=t[i].x;r+=t[i].y}return new e.ioVec(n/t.length,r/t.length)};e.getSpecVertex=function(e,t){var n=e[0];for(var r=0;r<e.length;r++)if(t(n,e[r]))n=e[r];return n};e.keyCodeIs=function(e,t){switch(t.keyCode){case 8:if(e=="backspace")return true;break;case 9:if(e=="tab")return true;break;case 13:if(e=="enter")return true;break;case 16:if(e=="shift")return true;break;case 17:if(e=="ctrl")return true;break;case 18:if(e=="alt")return true;break;case 19:if(e=="pause")return true;break;case 20:if(e=="caps lock")return true;break;case 27:if(e=="escape")return true;break;case 32:if(e=="space")return true;break;case 33:if(e=="page up")return true;break;case 34:if(e=="page down")return true;break;case 35:if(e=="end")return true;break;case 36:if(e=="home")return true;break;case 37:if(e=="left arrow")return true;break;case 38:if(e=="up arrow")return true;break;case 39:if(e=="right arrow")return true;break;case 40:if(e=="down arrow")return true;break;case 45:if(e=="insert")return true;break;case 46:if(e=="delete")return true;break;case 48:if(e=="0")return true;break;case 49:if(e=="1")return true;break;case 50:if(e=="2")return true;break;case 51:if(e=="3")return true;break;case 52:if(e=="4")return true;break;case 53:if(e=="5")return true;break;case 54:if(e=="6")return true;break;case 55:if(e=="7")return true;break;case 56:if(e=="8")return true;break;case 57:if(e=="9")return true;break;case 65:if(e=="a")return true;break;case 66:if(e=="b")return true;break;case 67:if(e=="c")return true;break;case 68:if(e=="d")return true;break;case 69:if(e=="e")return true;break;case 70:if(e=="f")return true;break;case 71:if(e=="g")return true;break;case 72:if(e=="h")return true;break;case 73:if(e=="i")return true;break;case 74:if(e=="j")return true;break;case 75:if(e=="k")return true;break;case 76:if(e=="l")return true;break;case 77:if(e=="m")return true;break;case 78:if(e=="n")return true;break;case 79:if(e=="o")return true;break;case 80:if(e=="p")return true;break;case 81:if(e=="q")return true;break;case 82:if(e=="r")return true;break;case 83:if(e=="s")return true;break;case 84:if(e=="t")return true;break;case 85:if(e=="u")return true;break;case 86:if(e=="v")return true;break;case 87:if(e=="w")return true;break;case 88:if(e=="x")return true;break;case 89:if(e=="y")return true;break;case 90:if(e=="z")return true;break;case 91:if(e=="left window")return true;break;case 92:if(e=="right window")return true;break;case 93:if(e=="select key")return true;break;case 96:if(e=="n0")return true;break;case 97:if(e=="n1")return true;break;case 98:if(e=="n2")return true;break;case 99:if(e=="n3")return true;break;case 100:if(e=="n4")return true;break;case 101:if(e=="n5")return true;break;case 102:if(e=="n6")return true;break;case 103:if(e=="n7")return true;break;case 104:if(e=="n8")return true;break;case 105:if(e=="n9")return true;break;case 106:if(e=="multiply")return true;break;case 107:if(e=="add")return true;break;case 109:if(e=="subtract")return true;break;case 110:if(e=="dec")return true;break;case 111:if(e=="divide")return true;break;case 112:if(e=="f1")return true;break;case 113:if(e=="f2")return true;break;case 114:if(e=="f3")return true;break;case 115:if(e=="f4")return true;break;case 116:if(e=="f5")return true;break;case 117:if(e=="f6")return true;break;case 118:if(e=="f7")return true;break;case 119:if(e=="f8")return true;break;case 120:if(e=="f9")return true;break;case 121:if(e=="f10")return true;break;case 122:if(e=="f11")return true;break;case 123:if(e=="f12")return true;break;case 144:if(e=="num lock")return true;break;case 156:if(e=="scroll lock")return true;break;case 186:if(e=="semi-colon")return true;break;case 187:if(e=="equal")return true;break;case 188:if(e=="comma")return true;break;case 189:if(e=="dash")return true;break;case 190:if(e=="period")return true;break;case 191:if(e=="forward slash")return true;break;case 192:if(e=="grave accent")return true;break;case 219:if(e=="open bracket")return true;break;case 220:if(e=="back slash")return true;break;case 221:if(e=="close bracket")return true;break;case 222:if(e=="single quote")return true;break;default:return false}}})(iio);(function(){function e(){this.ioVec.apply(this,arguments)}iio.ioVec=e;e.prototype.ioVec=function(e,t){if(typeof e!="undefined"&&typeof e.x!="undefined"){this.x=e.x||0;this.y=e.y||0}else{this.x=e||0;this.y=t||0}};e.prototype.clone=function(){return new e(this.x,this.y)};e.prototype.toString=function(){return"x:"+this.x+" y:"+this.y};e.toString=function(e){return"x:"+e.x+" y:"+e.y};e.prototype.set=function(e,t){if(typeof e.x!="undefined"){this.x=e.x;this.y=e.y}else{this.x=e;this.y=t}return this};e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};e.length=function(e,t){if(typeof e.x!="undefined")return Math.sqrt(e.x*e.x+e.y*e.y);else return Math.sqrt(e*e+t*t)};e.prototype.add=function(e,t){if(typeof e.x!="undefined"){this.x+=e.x;this.y+=e.y}else{this.x+=e;this.y+=t}return this};e.add=function(t,n,r,i){if(typeof t.x!="undefined")return(new e(t)).add(n,r);else return(new e(t,n)).add(r,i)};e.prototype.sub=function(e,t){if(typeof e.x!="undefined")this.add(-e.x,-e.y);else this.add(-e,-t);return this};e.sub=function(t,n,r,i){if(typeof t.x!="undefined")return(new e(t)).sub(n,r);else return(new e(t,n)).sub(r,i)};e.prototype.mult=function(e){this.x*=e;this.y*=e;return this};e.mult=function(t,n,r){if(typeof t.x!="undefined")return(new e(t)).mult(n);else return(new e(t,n)).mult(r)};e.prototype.div=function(e){this.x/=e;this.y/=e;return this};e.div=function(t,n,r){if(typeof t.x!="undefined")return(new e(t)).div(n);else return(new e(t,n)).div(r)};e.prototype.dot=function(e,t){if(typeof e.x!="undefined")return this.x*e.x+this.y*e.y;else return this.x*e+this.y*t};e.dot=function(e,t,n,r){if(typeof e.x!="undefined"){if(typeof t.x!="undefined")return e.x*t.x+e.y*t.y;else return e.x*t+e.y*n}else{if(typeof n.x!="undefined")return e*n.x+t*n.y;else return e*n+t*r}};e.prototype.normalize=function(){this.div(this.length());return this};e.normalize=function(t,n){return(new e(t,n)).normalize()};e.prototype.lerp=function(t,n,r){if(typeof t.x!="undefined")this.add(e.sub(t,this).mult(n));else this.add(e.sub(t,n,this).mult(r));return this};e.lerp=function(t,n,r,i,s){if(typeof t.x!="undefined")return(new e(t)).lerp(n,r,i);else return(new e(t,n)).lerp(r,i,s)};e.prototype.distance=function(e,t){if(typeof e.x!="undefined")return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y));else return Math.sqrt((e-this.x)*(e-this.x)+(t-this.y)*(t-this.y))};e.distance=function(e,t,n,r){if(typeof e.x!="undefined"){if(typeof t.x!="undefined")return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y));else return Math.sqrt((e.x-t)*(e.x-t)+(e.y-n)*(e.y-n))}else{if(typeof n.x!="undefined")return Math.sqrt((e-n.x)*(e-n.x)+(t-n.y)*(t-n.y));else return Math.sqrt((e-n)*(e-n)+(t-r)*(t-r))}}})();(function(){function t(){this.ioObj.apply(this,arguments)}var e=iio.ioVec;iio.ioObj=t;t.prototype.ioObj=function(t,n){this.pos=new e(t||0,n||0);this.styles={}};t.prototype.clone=function(){return new t(this.pos)};t.prototype.setPos=function(t,n){this.pos=new e(t,n);return this};t.prototype.translate=function(e,t){this.pos.add(e,t);return this};t.prototype.rotate=function(e){this.rotation=e;return this}})();(function(){function n(){this.ioLine.apply(this,arguments)}var e=iio.ioObj,t=iio.ioVec;iio.ioLine=n;iio.inherit(n,e);n.prototype._super=e.prototype;n.prototype.ioLine=function(e,n,r,i){this._super.ioObj.call(this,e,n);if(e instanceof t){if(n instanceof t)this.endPos=new t(n);else this.endPos=new t(n,r)}else if(r instanceof t)this.endPos=new t(r);else this.endPos=new t(r,i)};n.prototype.clone=function(){return new n(this.pos.x,this.pos.y,this.endPos.x,this.endPos.y)};n.prototype.set=function(e,t,n,r){if(typeof e==="ioLine"){this.pos.x=e.pos.x;this.pos.y=e.pos.y;this.endPos.x=e.endPos.x;this.endPos.y=e.endPos.y}else if(typeof e==="ioVec"){this.pos.x=e.x;this.pos.y=e.y;this.endPos.x=t.x;this.endPos.y=t.y}else{this.pos.x=e;this.pos.y=t;this.endPos.x=n;this.enPos.y=r}};n.prototype.setEndPos=function(e,n){if(typeof e==="ioVec")this.endPos=e;else this.endPos=new t(e||0,n||0)}})();(function(){function n(){this.ioMultiLine.apply(this,arguments)}var e=iio.ioVec,t=iio.ioLine;iio.ioMultiLine=n;iio.inherit(n,t);n.prototype._super=t.prototype;n.prototype.ioMultiLine=function(e){this.vertices=iio.getioVecsFromPointList(e);this._super.ioLine.call(this,this.vertices[0],this.vertices[this.vertices.length-1])};n.prototype.clone=function(){return new n(this.vertices)}})();(function(){function e(){this.ioGrid.apply(this,arguments)}iio.ioGrid=e;iio.inherit(e,iio.ioObj);e.prototype._super=iio.ioObj.prototype;e.prototype.ioGrid=function(e,t,n,r,i,s){if(typeof e.x!="undefined"){this._super.ioObj.call(this,e);n=t;r=n;i=r;s=i}else this._super.ioObj.call(this,e,t);this.R=r;this.C=n;this.res=new iio.ioVec(i,s||i);this.resetCells()};e.prototype.clone=function(){return new e(this.pos.x,this.pos.y,this.endPos.x,this.endPos.y)};e.prototype.resetCells=function(){this.cells=new Array(this.C);for(var e=0;e<this.cells.length;e++)this.cells[e]=new Array(this.R);for(var t=0;t<this.cells[0].length;t++)for(var n=0;n<this.cells.length;n++)this.cells[n][t]=new Object};e.prototype.getCellCenter=function(e,t,n){if(typeof e.x!="undefined"){if(t||false)return this.getCellCenter(this.getCellAt(e));return new iio.ioVec(this.pos.x+e.x*this.res.x+this.res.x/2,this.pos.y+e.y*this.res.y+this.res.y/2)}else{if(n||false)return this.getCellCenter(this.getCellAt(e,t));return new iio.ioVec(this.pos.x+e*this.res.x+this.res.x/2,this.pos.y+t*this.res.y+this.res.y/2)}};e.prototype.getCellAt=function(e,t){var n=new iio.ioVec(Math.floor((e.x-this.pos.x)/this.res.x),Math.floor((e.y-this.pos.y)/this.res.y));if(n.x>=0&&n.x<this.R&&n.y>=0&&n.y<this.C)return n;return false}})();(function(){function t(){this.ioText.apply(this,arguments)}var e=iio.ioObj;iio.ioText=t;iio.inherit(t,e);t.prototype._super=e.prototype;t.prototype.ioText=function(e,t,n){this._super.ioObj.call(this,t,n);this.text=e};t.prototype.clone=function(){var e=(new t(this.text,this.pos)).setFont(this.font).setTextAlign(this.textAlign);return e};t.prototype.setText=function(e){this.text=e;return this};t.prototype.setFont=function(e){this.font=e;return this};t.prototype.setTextAlign=function(e){this.textAlign=e;return this}})();(function(){function e(){this.ioShape.apply(this,arguments)}iio.ioShape=e;iio.inherit(e,iio.ioObj);e.prototype._super=iio.ioObj.prototype;e.prototype.ioShape=function(e,t){this._super.ioObj.call(this,e,t)};e.prototype.clone=function(){return new e(this.pos)}})();(function(){function e(){this.ioRect.apply(this,arguments)}iio.ioRect=e;iio.inherit(e,iio.ioShape);e.prototype._super=iio.ioShape.prototype;e.prototype.ioRect=function(e,t,n,r){this._super.ioShape.call(this,e,t);if(typeof e!="undefined"&&typeof e.x!="undefined"){this.width=t||0;this.height=n||t||0}else{this.width=n||0;this.height=r||n||0}};e.prototype.clone=function(){return new e(this.pos,this.width,this.height)};e.prototype.left=function(){return this.pos.x-this.width/2};e.prototype.right=function(){return this.pos.x+this.width/2};e.prototype.top=function(){return this.pos.y-this.height/2};e.prototype.bottom=function(){return this.pos.y+this.height/2};e.prototype.setSize=function(e,t){if(typeof e.x!="undefined"){this.width=e.x||0;this.height=e.y||0}else{this.width=e||0;this.height=t||0}return this};e.prototype.contains=function(e,t){t=e.y||t;e=e.x||e;e-=this.pos.x;t-=this.pos.y;var n=Math.sqrt(e*e+t*t);var r=Math.atan2(t,e);var i=r;if(typeof this.rotation!="undefined")i-=this.rotation;var s=Math.cos(i)*n;var o=Math.sin(i)*n;if(s>-.5*this.width&&s<.5*this.width&&o>-.5*this.height&&o<.5*this.height){return true}return false};e.prototype.intersectsWith=function(e){if(this.left()<e.right()&&this.right()>e.left()&&this.top()<e.bottom()&&this.bottom()>e.top())return true;return false}})();(function(){function e(){this.ioX.apply(this,arguments)}iio.ioX=e;iio.inherit(e,iio.ioRect);e.prototype._super=iio.ioRect.prototype;e.prototype.ioX=function(e,t,n,r){this._super.ioRect.call(this,e,t,n,r)};e.prototype.clone=function(){return new e(this.pos,this.width,this.height)}})();(function(){function e(){this.ioCircle.apply(this,arguments)}iio.ioCircle=e;iio.inherit(e,iio.ioShape);e.prototype._super=iio.ioShape.prototype;e.prototype.ioCircle=function(e,t,n){this._super.ioShape.call(this,e,t);if(typeof e.x!="undefined")this.radius=t||0;else this.radius=n||0};e.prototype.clone=function(){return new e(this.pos,this.radius)};e.prototype.setRadius=function(e){this.radius=e||0;return this};e.prototype.contains=function(e){if(e.distance(this.pos)<this.radius)return true;return false}})();(function(){function e(){this.ioPoly.apply(this,arguments)}iio.ioPoly=e;iio.inherit(e,iio.ioShape);e.prototype._super=iio.ioShape.prototype;e.prototype.ioPoly=function(e,t,n){if(typeof e.x!="undefined"){this._super.ioShape.call(this,e);this.vertices=iio.getioVecsFromPointList(t)}else if(e instanceof Array){this.vertices=iio.getioVecsFromPointList(e);this.pos=new iio.ioVec;this.styles={}}else{this._super.ioShape.call(this,e,t);this.vertices=iio.getioVecsFromPointList(n)}this.originToLeft=iio.getSpecVertex(this.vertices,function(e,t){if(e.x>t.x)return true;return false}).x;this.originToTop=iio.getSpecVertex(this.vertices,function(e,t){if(e.y>t.y)return true;return false}).y;this.width=iio.getSpecVertex(this.vertices,function(e,t){if(e.x<t.x)return true;return false}).x-this.originToLeft;this.height=iio.getSpecVertex(this.vertices,function(e,t){if(e.y<t.y)return true;return false}).y-this.originToTop};e.prototype.clone=function(){return new e(this.pos,this.vertices)};e.prototype.contains=function(e,t){t=e.y||t;e=e.x||e;e-=this.pos.x;t-=this.pos.y;if(Math.abs(this.pos.x-e)>this.width/2||Math.abs(this.pos.y-t)>this.height/2)return false;var n=j=c=0;for(n=0,j=this.vertices.length-1;n<this.vertices.length;j=n++){if(this.vertices[n].y>t!=this.vertices[j].y>t&&e<(this.vertices[j].x-this.vertices[n].x)*(t-this.vertices[n].y)/(this.vertices[j].y-this.vertices[n].y)+this.vertices[n].x)c=!c}return c}})();(function(){iio.Graphics={};iio.Graphics.transformContext=function(e,t,n){e.translate(t.x,t.y);if(typeof n!="undefined")e.rotate(n)};iio.Graphics.applyContextStyles=function(e,t){if(typeof t=="undefined")return;e.lineWidth=t.lineWidth;e.shadowColor=t.shadowColor;e.shadowBlur=t.shadowBlur;if(typeof t.shadowOffset!="undefined"){e.shadowOffsetX=t.shadowOffset.x;e.shadowOffsetY=t.shadowOffset.y}e.fillStyle=t.fillStyle;e.strokeStyle=t.strokeStyle};iio.Graphics.prepStyledContext=function(e,t){e.save();if(t!="undefined")iio.Graphics.applyContextStyles(e,t);if(typeof t!="undefined"&&typeof t.shadow!="undefined")iio.Graphics.applyContextStyles(e,t.shadow);return e};iio.Graphics.prepTransformedContext=function(e,t,n,r){e=e||t.ctx;n=n||t.pos;r=r||t.rotation;e.save();if(t.styles!="undefined")iio.Graphics.applyContextStyles(e,t.styles);iio.Graphics.transformContext(e,n,r);return e};iio.Graphics.finishPathShape=function(e,t,n,r,i,s){iio.Graphics.drawShadow(e,t);if(!iio.Graphics.drawImage(e,t.img,true)){e.drawImage(t.img,n,r,i,s);e.restore()}if(typeof t.anims!="undefined"&&!iio.Graphics.drawImage(e,t.anims[t.animKey][t.animIndex])){e.drawImage(t.anims[t.animKey][t.animIndex],n,r,i,s);e.restore()}if(typeof t.styles!="undefined"){if(typeof t.styles.fillStyle!="undefined")e.fill();if(typeof t.styles.strokeStyle!="undefined")e.stroke()}e.restore()};iio.Graphics.drawLine=function(e,t,n,r,i){e.beginPath();if(typeof t.x!="undefined"){e.moveTo(t.x,t.y);if(typeof n.x!="undefined")e.lineTo(n.x,n.y);else e.lineTo(n,r)}else{e.moveTo(t,n);if(typeof r.x!="undefined")e.lineTo(r.x,r.y);else e.lineTo(r,i)}e.stroke()};iio.Graphics.drawShadow=function(e,t){if(typeof t.styles=="undefined"||typeof t.styles.shadow=="undefined")return;e.save();iio.Graphics.applyContextStyles(e,t.styles.shadow);if(typeof t.styles.fillStyle!="undefined"||typeof t.img!="undefined"||typeof t.anims!="undefined")e.fill();else if(typeof t.styles.strokeStyle!="undefined")e.stroke();e.restore()};iio.Graphics.drawRectShadow=function(e,t){if(typeof t.styles=="undefined"||typeof t.styles.shadow=="undefined")return;e.save();iio.Graphics.applyContextStyles(e,t.styles.shadow);if(typeof t.styles.fillStyle!="undefined"||typeof t.img!="undefined"||typeof t.anims!="undefined")e.fillRect(-t.width/2,-t.height/2,t.width,t.height);else if(typeof t.styles.strokeStyle!="undefined")e.strokeRect(-t.width/2,-t.height/2,t.width,t.height);e.restore()};iio.Graphics.drawImage=function(e,t,n){if(typeof t!="undefined"){e.save();if(typeof t.pos!="undefined")iio.Graphics.transformContext(e,t.pos,t.rotation);if(n)e.clip();if(typeof t.size!="undefined")e.drawImage(t,-t.size.x/2,-t.size.y/2,t.size.x,t.size.y);else if(t.nativeSize)e.drawImage(t,-t.width/2,-t.height/2,t.width,t.height);else if(typeof t.scale!="undefined")e.drawImage(t,-t.width*t.scale/2,-t.height*t.scale/2,t.width*t.scale,t.height*t.scale);else return false;e.restore();return true}return true}})();(function(){function e(e){this.styles.lineWidth=e;return this}function t(e,t){this.styles.strokeStyle=e;this.styles.lineWidth=t||this.styles.lineWidth;return this}function n(e){this.styles.shadow.shadowColor=e;return this}function r(e){this.styles.shadow.shadowBlur=e;return this}function o(e,t){this.styles.shadow.shadowOffset=new iio.ioVec(e,t||e);return this}function u(e){this.styles.fillStyle=e;return this}function a(e){this.styles.refLine=e||true;return this}function l(e,t,n,r){this.styles.shadow={};this.styles.shadow.shadowColor=e;if(typeof t.x!="undefined"){this.styles.shadow.shadowOffset=new iio.ioVec(t);this.styles.shadow.shadowBlur=n}else{this.styles.shadow.shadowOffset=new iio.ioVec(t,n);this.styles.shadow.shadowBlur=r}return this}function m(e,t){this.img.pos=new iio.ioVec(e,t||e);return this}function g(e){this.img.scale=e;return this}function y(e){this.img.rotation=e;return this}function b(e,t){if(e=="native")this.img.nativeSize=true;else this.img.size=new iio.ioVec(e,t||e);return this}function w(e,t){if(typeof e.src!="undefined")this.img=e;else{this.img=new Image;this.img.src=e;this.img.onload=t}return this}function E(e,t,n){this.animIndex=n||0;if(typeof this.anims=="undefined")this.anims=[];this.animKey=this.anims.length;this.anims[this.animKey]=[];for(var r=0;r<e.length;r++){if(typeof e[r].src!="undefined")this.anims[this.animKey][r]=e[r];else{this.anims[this.animKey][r]=new Image;this.anims[this.animKey][r].src=e[r]}if(r==this.animIndex)this.anims[this.animKey][r].onload=t}return this}function S(e,t){if(typeof e.src!="undefined"){this.img=e;if(typeof this.radius!="undefined"){this.radius=e.width/2}else{this.width=e.width;this.height=e.height}}else{this.img=new Image;this.img.src=e;this.img.onload=function(){if(typeof this.radius!="undefined"){this.radius=this.img.width/2}else{this.width=this.img.width||0;this.height=this.img.height||0}if(typeof t!="undefined")t()}.bind(this)}return this}function x(e,t,n){if(typeof n=="undefined"&&iio.isNumber(t))n=t;n=n||0;if(typeof e[0].src!="undefined"){this.addAnim(e);this.width=e[0].width;this.height=e[0].height}else{this.addAnim(e);this.animKey=0;this.animIndex=n;this.anims[0][n].onload=function(){this.width=this.anims[0][n].width||0;this.height=this.anims[0][n].height||0;if(typeof t!="undefined"&&!iio.isNumber(t))t()}.bind(this)}return this}function T(){this.animIndex++;if(this.animIndex>=this.anims[this.animKey].length)this.animIndex=0;this.clearDraw();return this}function N(e){this.animIndex=e}function C(e,t,n){e=iio.Graphics.prepTransformedContext(e,this,t,n);iio.Graphics.drawRectShadow(e,this);if(!iio.Graphics.drawImage(e,this.img)){e.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height);e.restore()}if(typeof this.anims!="undefined"&&!iio.Graphics.drawImage(e,this.anims[this.animKey][this.animIndex])){e.drawImage(this.anims[this.animKey][this.animIndex],-this.width/2,-this.height/2,this.width,this.height);e.restore()}if(typeof this.styles!="undefined"){if(typeof this.styles.fillStyle!="undefined")e.fillRect(-this.width/2,-this.height/2,this.width,this.height);if(typeof this.styles.strokeStyle!="undefined")e.strokeRect(-this.width/2,-this.height/2,this.width,this.height)}e.restore();return this}function k(e){this.polyDraw=e;return this}function L(e,t,n){e=iio.Graphics.prepTransformedContext(e,this,t,n);e.beginPath();e.arc(0,0,this.radius,0,2*Math.PI,false);iio.Graphics.drawShadow(e,this);if(this.polyDraw)var r=false;else var r=true;if(!iio.Graphics.drawImage(e,this.img,r)){e.drawImage(this.img,-this.radius,-this.radius,this.radius*2,this.radius*2);e.restore()}if(typeof this.anims!="undefined"&&!iio.Graphics.drawImage(e,this.anims[this.animKey][this.animIndex])){e.drawImage(this.anims[this.animKey][this.animIndex],-this.radius,-this.radius,this.radius*2,this.radius*2);e.restore()}if(typeof this.styles!="undefined"){if(typeof this.styles.fillStyle!="undefined")e.fill();if(typeof this.styles.strokeStyle!="undefined")e.stroke();if(this.styles.refLine)iio.Graphics.drawLine(e,0,0,this.radius,0)}e.restore();return this}iio.ioObj.prototype.setLineWidth=e;iio.ioObj.prototype.setStrokeStyle=t;iio.ioObj.prototype.setShadowColor=n;iio.ioObj.prototype.setShadowBlur=r;iio.ioObj.prototype.setShadowOffset=o;iio.ioObj.prototype.setShadow=l;iio.ioText.prototype.setFillStyle=u;iio.ioShape.prototype.setFillStyle=u;iio.ioCircle.prototype.drawReferenceLine=a;if(typeof Box2D!="undefined"){var c=Box2D.Collision.Shapes.b2Shape,h=Box2D.Collision.Shapes.b2PolygonShape,p=Box2D.Collision.Shapes.b2CircleShape,d=Box2D.Dynamics.Joints.b2Joint;h.prototype.prepGraphics=function(e){this.originToLeft=iio.getSpecVertex(this.m_vertices,function(e,t){if(e.x>t.x)return true;return false}).x*e;this.originToTop=iio.getSpecVertex(this.m_vertices,function(e,t){if(e.y>t.y)return true;return false}).y*e;this.width=iio.getSpecVertex(this.m_vertices,function(e,t){if(e.x<t.x)return true;return false}).x*e-this.originToLeft;this.height=iio.getSpecVertex(this.m_vertices,function(e,t){if(e.y<t.y)return true;return false}).y*e-this.originToTop;this.styles={};return this};p.prototype.prepGraphics=function(e){this.radius=this.m_radius*e;this.styles={};return this};function v(){this.styles={};return this}d.prototype.prepGraphics=v;c.prototype.prepGraphics=v;d.prototype.setLineWidth=e;c.prototype.setLineWidth=e;d.prototype.setStrokeStyle=t;c.prototype.setStrokeStyle=t;d.prototype.setShadowColor=n;c.prototype.setShadowColor=n;d.prototype.setShadowBlur=r;c.prototype.setShadowBlur=r;d.prototype.setShadowOffset=o;c.prototype.setShadowOffset=o;d.prototype.setShadow=l;c.prototype.setShadow=l;c.prototype.setFillStyle=u;p.prototype.drawReferenceLine=a}iio.ioShape.prototype.setImgOffset=m;iio.ioShape.prototype.setImgScale=g;iio.ioShape.prototype.setImgRotation=y;iio.ioShape.prototype.setImgSize=b;iio.ioShape.prototype.addImage=w;iio.ioShape.prototype.addAnim=E;iio.ioRect.prototype.createWithImage=S;iio.ioCircle.prototype.createWithImage=S;iio.ioRect.prototype.createWithAnim=x;iio.ioShape.prototype.nextAnimFrame=T;iio.ioShape.prototype.setAnimFrame=N;if(typeof Box2D!="undefined"){c.prototype.setImgOffset=m;c.prototype.setImgScale=g;c.prototype.setImgRotation=y;c.prototype.setImgSize=b;c.prototype.addImage=w;c.prototype.addAnim=E;c.prototype.nextAnimFrame=T;c.prototype.setAnimFrame=N}iio.ioShape.prototype.clearDraw=function(e){this.redraw=true;if(typeof this.clearSelf!="undefined"&&typeof this.ctx!="undefined")this.clearSelf(this.ctx);return this};iio.ioLine.prototype.draw=function(e){e=e||this.ctx;iio.Graphics.prepStyledContext(e,this.styles);iio.Graphics.drawLine(e,this.pos,this.endPos);e.restore();return this};iio.ioMultiLine.prototype.draw=function(e){e=e||this.ctx;iio.Graphics.prepStyledContext(e,this.styles);for(var t=1;t<this.vertices.length;t++)iio.Graphics.drawLine(e,this.vertices[t-1],this.vertices[t]);e.restore();return this};iio.ioGrid.prototype.draw=function(e){e=e||this.ctx;iio.Graphics.prepStyledContext(e,this.styles);for(var t=1;t<this.R;t++)iio.Graphics.drawLine(e,this.pos.x,this.pos.y+t*this.res.y,this.pos.x+this.C*this.res.x,this.pos.y+t*this.res.y);for(var n=1;n<this.C;n++)iio.Graphics.drawLine(e,this.pos.x+n*this.res.x,this.pos.y,this.pos.x+n*this.res.x,this.pos.y+this.R*this.res.y);e.restore();return this};iio.ioX.prototype.draw=function(e){e=e||this.ctx;iio.Graphics.prepStyledContext(e,this.styles);iio.Graphics.drawLine(e,iio.ioVec.sub(this.pos,this.width/2,this.height/2),iio.ioVec.add(this.pos,this.width/2,this.height/2));iio.Graphics.drawLine(e,iio.ioVec.add(this.pos,this.width/2,-this.height/2),iio.ioVec.add(this.pos,-this.width/2,this.height/2));e.restore();return this};iio.ioText.prototype.draw=function(e){e=e||this.ctx;iio.Graphics.prepStyledContext(e,this.styles);iio.Graphics.transformContext(e,this.pos,this.rotation);e.font=this.font;e.textAlign=this.textAlign;if(typeof this.styles.fillStyle!="undefined")e.fillText(this.text,0,0);if(typeof this.styles.strokeStyle!="undefined")e.strokeText(this.text,0,0);e.restore();return this};iio.ioRect.prototype.draw=C;iio.ioRect.prototype.clearSelf=function(e){e.save();iio.Graphics.transformContext(e,this.pos,this.rotation);var t=new iio.ioVec(2,2);if(typeof this.styles!="undefined"){if(typeof this.styles.lineWidth!="undefined")t.add(this.styles.lineWidth,this.styles.lineWidth);else if(typeof this.styles.strokeStyle!="undefined")t.add(2,2);if(typeof this.styles.shadow!="undefined"&&typeof this.styles.shadow.shadowOffset!="undefined"){var n=new iio.ioVec(-this.width/2-t.x,-this.height/2-t.y);n.add(-Math.abs(this.styles.shadow.shadowOffset.x)-8,-Math.abs(this.styles.shadow.shadowOffset.y)-8);t.add(Math.abs(this.styles.shadow.shadowOffset.x)*2+16,Math.abs(this.styles.shadow.shadowOffset.y)*2+16);e.clearRect(n.x,n.y,this.width+t.x,this.height+t.y);e.restore();return this}}e.clearRect(-this.width/2-t.x/2,-this.height/2-t.y/2,this.width+t.x,this.height+t.y);e.restore();return this};iio.ioCircle.prototype.draw=L;iio.ioCircle.prototype.setPolyDraw=k;if(typeof Box2D!="undefined"){p.prototype.draw=L;p.prototype.setPolyDraw=k}iio.ioCircle.prototype.clearSelf=function(e){e.clearRect(-this.radius,-this.radius,this.radius*2,this.radius*2)};iio.ioPoly.prototype.draw=function(e){e=iio.Graphics.prepTransformedContext(e,this);e.beginPath();e.moveTo(this.vertices[0].x,this.vertices[0].y);for(var t=1;t<this.vertices.length;t++)e.lineTo(this.vertices[t].x,this.vertices[t].y);e.closePath();iio.Graphics.finishPathShape(e,this,this.originToLeft,this.originToTop,this.width,this.height)};if(typeof Box2D!="undefined")Box2D.Collision.Shapes.b2PolygonShape.prototype.draw=function(e,t,n,r){e=iio.Graphics.prepTransformedContext(e,this,t,n);e.beginPath();e.moveTo(this.m_vertices[0].x*r,this.m_vertices[0].y*r);for(var i=1;i<this.m_vertices.length;i++)e.lineTo(this.m_vertices[i].x*r,this.m_vertices[i].y*r);e.closePath();iio.Graphics.finishPathShape(e,this,this.originToLeft,this.originToTop,this.width,this.height)};iio.ioPoly.prototype.clearSelf=function(e){e.save();iio.Graphics.transformContext(e,this.pos,this.rotation);e.clearRect(this.originToLeft,this.originToTop,this.width,this.height);e.restore();return this};if(typeof Box2D!="undefined"){Box2D.Dynamics.b2Body.draw=function(e,t){for(f=this.objs[i].GetFixtureList();f;f=f.m_next){s=f.GetShape();if(typeof s.draw!="undefined")s.draw(e,new iio.ioVec(this.objs[i].m_xf.position.x*t,this.objs[i].m_xf.position.y*t),this.objs[i].GetAngle(),t)}};function A(e,t){var n=this.GetBodyA();var r=this.GetBodyB();var i=n.m_xf;var s=r.m_xf;var o=i.position;var u=s.position;var a=this.GetAnchorA();var f=this.GetAnchorB();iio.Graphics.prepStyledContext(e,this.styles);switch(this.m_type){case Box2D.Dynamics.Joints.b2Joint.e_distanceJoint:iio.Graphics.drawLine(e,a.x*t,a.y*t,f.x*t,f.y*t);break;case Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint:{var l=this instanceof b2PulleyJoint?this:null;var c=l.GetGroundAnchorA();var h=l.GetGroundAnchorB();iio.Graphics.drawLine(e,c.x*t,c.y*t,a.x*t,a.y*t);iio.Graphics.drawLine(e,h.x*t,h.y*t,f.x*t,f.y*t);iio.Graphics.drawLine(e,c.x*t,c.y*t,h.x*t,h.y*t)}break;case Box2D.Dynamics.Joints.b2Joint.e_mouseJoint:iio.Graphics.drawLine(e,a.x*t,a.y*t,f.x*t,f.y*t);break;default:if(n!=this.m_groundBody)iio.Graphics.drawLine(e,o.x*t,o.y*t,a.x*t,a.y*t);iio.Graphics.drawLine(e,a.x*t,a.y*t,f.x*t,f.y*t);if(r!=this.m_groundBody)iio.Graphics.drawLine(e,u.x*t,u.y*t,f.x*t,f.y*t)}}Box2D.Dynamics.Joints.b2Joint.prototype.draw=A}})();(function(){function n(t){if(typeof this.vel!="undefined"&&this.vel.length()>0||typeof this.torque!="undefined"&&this.torque>0)this.clearDraw();if(typeof this.vel!="undefined")this.translate(new e(this.vel.x,this.vel.y));if(typeof this.torque!="undefined"){this.rotation+=this.torque;if(this.rotation>2*Math.PI)this.rotation-=2*Math.PI;else if(this.rotation<-2*Math.PI)this.rotation+=2*Math.PI}if(this.shrinkRate>0){if(typeof this.radius!="undefined"){this.setRadius(this.radius*(1-this.shrinkRate));if(Math.abs(this.radius<.1))return false}else{this.setSize(this.width*(1-this.shrinkRate),this.height*(1-this.shrinkRate));if(Math.abs(this.width<.1)&&Math.abs(this.height<.1))return false}}if(this.bounds!=null){var n=this.width/2||this.radius||0;var r=this.height/2||this.radius||0;if(typeof this.bounds.top!="undefined"&&this.pos.y-r<this.bounds.top.val){if(typeof this.bounds.top.callback!="undefined")return this.bounds.top.callback(this)||false;return false}if(typeof this.bounds.right!="undefined"&&this.pos.x+n>this.bounds.right.val){if(typeof this.bounds.right.callback!="undefined")return this.bounds.right.callback(this)||false;return false}if(typeof this.bounds.bottom!="undefined"&&this.pos.y+r>this.bounds.bottom.val){if(typeof this.bounds.bottom.callback!="undefined")return this.bounds.bottom.callback(this)||false;return false}if(typeof this.bounds.left!="undefined"&&this.pos.x-n<this.bounds.left.val){if(typeof this.bounds.left.callback!="undefined")return this.bounds.left.callback(this)||false;return false}}return true}function r(t,n){this.vel=new e(t,n);return this}function i(e){this.torque=e;if(typeof this.rotation=="undefined")this.rotation=0;return this}function s(e,t,n){if(typeof this.bounds=="undefined")this.bounds={};if(e=="top"){this.bounds.top={};this.bounds.top.val=t;this.bounds.top.callback=n}else if(e=="right"){this.bounds.right={};this.bounds.right.val=t;this.bounds.right.callback=n}else if(e=="bottom"){this.bounds.bottom={};this.bounds.bottom.val=t;this.bounds.bottom.callback=n}else if(e=="left"){this.bounds.left={};this.bounds.left.val=t;this.bounds.left.callback=n}return this}function o(e,t,n,r,i){this.bounds={};if(typeof e!="undefined"){this.bounds.top={};this.bounds.top.val=e;this.bounds.top.callback=i}if(typeof t!="undefined"){this.bounds.right={};this.bounds.right.val=t;this.bounds.right.callback=i}if(typeof n!="undefined"){this.bounds.bottom={};this.bounds.bottom.val=n;this.bounds.bottom.callback=i}if(typeof r!="undefined"){this.bounds.left={};this.bounds.left.val=r;this.bounds.left.callback=i}return this}function u(e){this.shrinkRate=e;return this}function a(){this.update=n;this.setVel=r;this.setTorque=i;this.setBounds=o;this.setBound=s;this.shrink=u;return this}var e=iio.ioVec,t=iio.ioObj;iio.ioShape.prototype.enableKinematics=a;iio.ioText.prototype.enableKinematics=a})();(function(){function e(){this.ioCollisionTag.apply(this,arguments)}iio.ioCollisionTag=e;e.prototype.ioCollisionTag=function(e,t){this.tag=e;this.callback=t}})();(function(){function r(){this.ioGroup.apply(this,arguments)}var e=iio.ioVec,t=iio.ioObj,n=iio.ioCollisionTag;iio.ioGroup=r;r.prototype.ioGroup=function(e,t){this.tag=e;this.zIndex=t;this.objs=[]};r.prototype.addObj=function(e){this.objs[this.objs.length]=e};r.prototype.rmvObj=function(e){for(var t=0;t<this.objs.length;t++)if(e==this.objs[t]){this.objs.splice(t,1);return true}return false};r.prototype.addCollisionCallback=function(e,t){if(typeof this.collisionTags=="undefined")this.collisionTags=[];this.collisionTags[this.collisionTags.length]=new n(e,t)};r.prototype.update=function(e){for(var t=this.objs.length-1;t>=0;t--)if(typeof this.objs[t]!="undefined"){if(typeof this.objs[t].update!="undefined"&&!this.objs[t].update(e))this.objs.splice(t,1);else if(this.objs[t].redraw)this.redraw=true}};r.prototype.draw=function(t,n){for(var r=0;r<this.objs.length;r++){if(typeof this.objs[r].pos!="undefined")this.objs[r].draw(t);else if(typeof this.objs[r].m_I!="undefined")for(f=this.objs[r].GetFixtureList();f;f=f.m_next){s=f.GetShape();if(typeof s.draw!="undefined")s.draw(t,new e(this.objs[r].m_xf.position.x*n,this.objs[r].m_xf.position.y*n),this.objs[r].GetAngle(),n)}else if(typeof this.objs[r].m_edgeA!="undefined")this.objs[r].draw(t,n)}}})();(function(){function r(){this.ioAppManager.apply(this,arguments)}var e=iio.ioVec,t=iio.ioGroup,n=iio.ioCollisionTag;iio.ioAppManager=r;r.prototype.ioAppManager=function(e,t,n,r){this.cnvs=[];this.ctxs=[];if(typeof e=="undefined")throw new Error("ioApp.initialize: No app provided | Docs: ioApp -> Constructors");if(typeof n=="undefined"&&(typeof t=="string"||t instanceof String)){this.addCanvas(t)}else{if(typeof t=="string"||t instanceof String){n=n||window.innerWidth;r=r||window.innerHeight;if(!document.getElementById(t))throw new Error("ioApp.initialize: Invalid element id | Docs: ioApp -> Constructors")}else{r=n||window.innerHeight;n=t||window.innerWidth}this.addCanvas(0,n,r,t)}this.canvas=this.cnvs[0];this.context=this.ctxs[0];this.app=new e(this);this.addWindowListeners()};r.prototype.setFramerate=function(e,t,n,r){if(typeof t!="undefined"&&typeof t.draw!="undefined"){if(typeof r=="undefined")var i=r;r=n||this.ctxs[0];n=t;t=i||function(){};n.ctx=r}else n=n||0;if(iio.isNumber(n))n=this.cnvs[n];if(typeof n.lastTime=="undefined")n.lastTime=0;if(typeof r!="undefined")n.ctx=r;iio.requestTimeout(e,n.lastTime,function(r){n.lastTime=r;io.setFramerate(e,t,n);if(typeof n.update!="undefined")n.update(r);if(typeof t!="undefined")t(r);if(n.redraw){n.draw();n.redraw=false}}.bind([io=this,n]));return this};r.prototype.setAnimFPS=function(e,t,n){n=n||0;if(t instanceof Array)this.setFramerate(e,function(){for(var e=0;e<t.length;e++)t[e].nextAnimFrame()},t,this.ctxs[n]);else this.setFramerate(e,function(){t.nextAnimFrame()},t,this.ctxs[n])};r.prototype.setB2Framerate=function(e,t){if(typeof this.b2lastTime=="undefined")this.b2lastTime=0;if(typeof this.b2World!="undefined")this.b2World.Step(1/this.fps,10,10);iio.requestTimeout(e,this.b2lastTime,function(n){b2.b2lastTime=n;b2.setB2Framerate(e,t);if(typeof b2.b2World!="undefined")b2.b2World.Step(1/e,10,10);t(n);if(typeof b2.b2DebugDraw!="undefined"&&b2.b2DebugDraw)b2.b2World.DrawDebugData();else b2.draw(b2.b2Cnv);if(typeof this.b2World!="undefined")b2.b2World.ClearForces()}.bind([b2=this]))};r.prototype.addB2World=function(e,t){this.b2World=e;this.b2Scale=30;this.b2Cnv=t||0;return e};r.prototype.activateDebugger=function(){if(typeof iio.ioAppDebugger=="undefined")console.warn("ioAppManager.startDebugger: the ioAppDebugger package is missing");else this.debugger=new iio.ioAppDebugger(this)};r.prototype.update=function(e){for(var t=0;t<this.cnvs.length;t++)this.cnvs[t].update(e)};r.prototype.draw=function(e){if(typeof e=="undefined")for(var t=0;t<this.cnvs.length;t++)this.cnvs[t].draw(this.b2Scale);else this.cnvs[e].draw(this.b2Scale);return this};r.prototype.addCanvas=function(e,t,n,r,i){var s=this.cnvs.length;if(typeof e=="string"||e instanceof String){if(!document.getElementById(e))throw new Error("ioAppManager.addCanvas: Invalid canvas id '"+e+"'");this.cnvs[s]=document.getElementById(e);this.ctxs[s]=this.cnvs[s].getContext("2d");if(typeof this.cnvs[s].getContext=="undefined")throw new Error("ioAppManager.addCanvas: given id did not correspond to a canvas object");this.setCanvasProperties(s);this.setCanvasFunctions(s);this.addFocusListeners(s);return s}this.cnvs[s]=document.createElement("canvas");this.cnvs[s].width=t||this.cnvs[0].width;this.cnvs[s].height=n||this.cnvs[0].height;this.cnvs[s].style.zIndex=e||-s;if(typeof r=="string"||r instanceof String)document.getElementById(id).appendChild(this.cnvs[s]);else if(this.cnvs.length>1){this.cnvs[s].style.position="absolute";var o=this.getCanvasOffset();this.cnvs[s].style.left=o.x+"px";this.cnvs[s].style.top=o.y+"px";this.cnvs[s].style.margin=0;this.cnvs[s].style.padding=0;this.cnvs[0].parentNode.appendChild(this.cnvs[s])}else document.body.appendChild(this.cnvs[s]);this.cnvs[s].className+="ioCanvas";if(r instanceof Array)for(var u=0;u<r.length;u++)this.cnvs[s].className+=" "+r[u];if(i instanceof Array)for(var u=0;u<i.length;u++)this.cnvs[s].className+=" "+i[u];else if(typeof i=="string"||i instanceof String)this.cnvs[s].className+=" "+i;if(this.cnvs[s].width==window.innerWidth&&this.cnvs[s].height==window.innerHeight){this.cnvs[s].style.display="block";this.cnvs[s].style.position="absolute";this.cnvs[s].style.top=document.body.style.margin=document.body.style.padding="0";document.body.style.overflow="hidden";this.fullScreen=true}this.ctxs[s]=this.cnvs[s].getContext("2d");this.setCanvasProperties(s);this.setCanvasFunctions(s);this.addFocusListeners(s);return s};r.prototype.setCanvasFunctions=function(e){this.ctxs[e].webkitImageSmoothingEnabled=true;this.cnvs[e].draw=function(e){this.getContext("2d").clearRect(0,0,this.width,this.height);if(typeof this.groups!="undefined")for(var t=0;t<this.groups.length;t++)this.groups[t].draw(this.getContext("2d"),e)};this.cnvs[e].update=function(e){if(typeof this.groups!="undefined")for(var t=this.groups.length-1;t>=0;t--){this.groups[t].update(e);if(typeof this.groups[t].collisionTags!="undefined")for(var n=0;n<this.groups[t].collisionTags.length;n++)this.checkCollisions(this.groups[t],this.groups[this.indexOfTag(this.groups[t].collisionTags[n].tag)],this.groups[t].collisionTags[n].callback);if(this.groups[t].redraw)this.redraw=true}};this.cnvs[e].indexOfTag=function(e){if(typeof this.groups!="undefined")for(var t=0;t<this.groups.length;t++)if(this.groups[t].tag==e)return t;return"NO"};this.cnvs[e].checkCollisions=function(e,t,n){if(e==t){var r=[];var i;var s,o}for(var u=0;u<e.objs.length;u++)for(var a=0;a<t.objs.length;a++)if(typeof e.objs[u]!="undefined"&&e.objs[u]!=t.objs[a]&&e.objs[u].intersectsWith(t.objs[a])){if(r instanceof Array){i=false;for(o=0;o<r.length;o++)if(u==r[o][0]&&a==r[o][1]||u==r[o][1]&&a==r[o][0])i=true;if(!i){s=r.length;r[s]=[];r[s][0]=u;r[s][1]=a;n(e.objs[u],t.objs[a])}}else n(e.objs[u],t.objs[a])}}};r.prototype.setCanvasProperties=function(t){this.cnvs[t].pos=this.getCanvasOffset(t);this.cnvs[t].center=new e(this.cnvs[t].width/2,this.cnvs[t].height/2)};r.prototype.addFocusListeners=function(e){this.focused=false;this.cnvs[e].addEventListener("mouseover",function(t){this[0].focused=true;if(typeof this[0].app.focusOn!="undefined")this[0].app.focusOn(t,e)}.bind([this,e]),false);this.cnvs[e].addEventListener("mouseout",function(t){this[0].focused=false;if(typeof this[0].app.focusOff!="undefined")this[0].app.focusOff(t,e)}.bind([this,e]),false)};r.prototype.addWindowListeners=function(){iio.addEvent(window,"resize",function(e){if(this.fullScreen){io.canvas.width=window.innerWidth;io.canvas.height=window.innerHeight}for(var t=0;t<this.cnvs.length;t++){this.setCanvasProperties(t);if(t>0){this.cnvs[t].style.left=this.cnvs[0].offsetLeft+"px";this.cnvs[t].style.top=this.cnvs[0].offsetTop+"px"}}if(typeof this.app.onResize!="undefined")this.app.onResize(e)}.bind(this),false);iio.addEvent(window,"scroll",function(e){for(var t=0;t<this.cnvs.length;t++)this.setCanvasProperties(t);if(typeof this.app.onScroll!="undefined")this.app.onScroll(e)}.bind(this),false)};r.prototype.drawPartialPixels=function(e){e=e||true;if(e)this.partialPixels=true;else this.partialPixels=false;return this};r.prototype.activateB2Debugger=function(e,t){e=e||true;t=t||0;if(e){this.b2DebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2DebugDraw.SetSprite(this.ctxs[t]);this.b2DebugDraw.SetDrawScale(this.b2Scale);this.b2DebugDraw.SetFillAlpha(.5);this.b2DebugDraw.SetLineThickness(1);this.b2DebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2World.SetDebugDraw(this.b2DebugDraw);return this.b2DebugDraw}};r.prototype.addGroup=function(e,n,r){r=r||0;if(typeof this.cnvs[r].groups=="undefined")this.cnvs[r].groups=[];var i=n||0;var s=this.indexFromzIndexInsertSort(i,this.cnvs[r].groups);this.cnvs[r].groups.insert(s,new t(e,i));return s};r.prototype.addToGroup=function(e,t,n,r){r=r||0;var i=this.indexOfTag(e,r);var s=iio.isNumber(i);if(typeof this.cnvs[r].groups=="undefined"||!s)i=this.addGroup(e,n,r);this.cnvs[r].groups[i].addObj(t,r);return t};r.prototype.addObj=function(e,t,n){n=n||0;if(typeof this.cnvs[n].groups=="undefined")this.cnvs[n].groups=[];t=t||0;for(var r=0;r<this.cnvs[n].groups.length;r++)if(this.cnvs[n].groups[r].zIndex==t){this.cnvs[n].groups[r].addObj(e);if(typeof this.fps=="undefined"&&typeof e.pos!="undefined")e.draw(this.ctxs[n]);return e}this.addGroup(t,t,n);this.addToGroup(t,e,t,n);if(typeof this.fps=="undefined"&&typeof e.pos!="undefined")e.draw(this.ctxs[n]);return e};r.prototype.indexFromzIndexInsertSort=function(e,t){var n=0;while(n<t.length&&t[n].zIndex<e)n++;return n};r.prototype.indexOfTag=function(e,t){t=t||0;if(typeof this.cnvs[t].groups!="undefined")for(var n=0;n<this.cnvs[t].groups.length;n++)if(this.cnvs[t].groups[n].tag==e)return n;return"NO"};r.prototype.setCollisionCallback=function(e,t,n,r){if(typeof n=="undefined"||iio.isNumber(n)){n=t;t=e}this.cnvs[r||0].groups[this.indexOfTag(e)].addCollisionCallback(t,n)},r.prototype.rmvObj=function(e,t){t=t||0;if(typeof this.cnvs[t].groups!="undefined")for(var n=0;n<this.cnvs[t].groups.length;n++)if(this.cnvs[t].groups[n].rmvObj(e))return true;return false};r.prototype.rmvAll=function(e){if(typeof e=="undefined"){for(e=0;e<this.cnvs.length;e++)if(typeof this.cnvs[e].groups!="undefined")this.cnvs[e].groups=[]}else if(typeof this.cnvs[e].groups!="undefined")this.cnvs[e].groups=[];return this};r.prototype.rmvFromGroup=function(e,t,n){if(typeof n=="undefined"){for(n=0;n<this.cnvs.length;n++)if(typeof this.cnvs[n].groups!="undefined")for(var r=0;r<this.cnvs[n].groups.length;r++)if(this.cnvs[n].groups[r].tag==t)return this.cnvs[n].groups[r].rmvObj(e)}else if(typeof this.cnvs[n].groups!="undefined")for(var r=0;r<this.cnvs[n].groups.length;r++)if(this.cnvs[n].groups[r].tag==t)return this.cnvs[n].groups[r].rmvObj(e);return false};r.prototype.setBGColor=function(e,t){t=t||0;this.cnvs[t].style.backgroundColor=e;return this};r.prototype.setBGPattern=function(e,t){t=t||0;this.cnvs[t].style.backgroundImage="url('"+e+"')";return this};r.prototype.setBGImage=function(e,t){t=t||0;this.cnvs[t].style.backgroundRepeat="no-repeat";return this.setBGPattern(e,t)};r.prototype.getEventPosition=function(t,n){n=n||0;var r;if(iio.isiPad){if(t.touches==null||t.touches.item(0)==null)return-1;else r=new e(t.touches.item(0).screenX,t.touches.item(0).screenY)}r=new e(t.clientX,t.clientY);r.sub(this.cnvs[n].pos);return r};r.prototype.getCanvasOffset=function(t){t=t||0;var n=this.cnvs[t].getBoundingClientRect();return new e(n.left,n.top)};r.prototype.getB2BodyAt=function(e,t,n){function i(e){if(e.GetBody().GetType()!=Box2D.Dynamics.b2Body.b2_staticBody)if(e.GetShape().TestPoint(e.GetBody().GetTransform(),t))return e.GetBody();return false}if(typeof t.x=="undefined")t=new Box2D.Common.Math.b2Vec2(t,n);var r=new Box2D.Collision.b2AABB;r.lowerBound.Set(t.x-.001,t.y-.001);r.upperBound.Set(t.x+.001,t.y+.001);return this.b2World.QueryAABB(i,r)}})()